app-id: com.bitwarden.desktop
base: org.electronjs.Electron2.BaseApp
base-version: "18.08"
command: bitwarden
rename-desktop-file: bitwarden.desktop
rename-icon: bitwarden
runtime: org.freedesktop.Platform
runtime-version: "18.08"
sdk: org.freedesktop.Sdk
separate-locales: false
finish-args:
  - --device=dri
  - --filesystem=xdg-download
  - --share=ipc
  - --share=network
  - --socket=x11
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.freedesktop.secrets
modules:
  -
    name: libsecret
    config-opts:
      - --disable-gtk-doc
      - --disable-introspection
      - --disable-manpages
      - --disable-static
    cleanup:
      - /bin
      - /include
      - /lib/*.la
      - /lib/debug
      - /lib/pkgconfig
    sources:
      -
        type: archive
        sha256: 047a15af3a0eaf3344c10f138fe21561052104abd05d18d85b438e1d002c5ac3
        url: https://gitlab.gnome.org/GNOME/libsecret/-/archive/0.18.7/libsecret-0.18.7.tar.gz

  -
    name: bitwarden
    buildsystem: simple
    build-commands:
      - ar -x Bitwarden-*.deb
      - tar -xf data.tar.xz
      - cp -r opt/* usr/* /app
      - desktop-file-edit --set-key=Exec --set-value="/app/bin/bitwarden %U" /app/share/applications/bitwarden.desktop
      - install -D -m0644 -t /app/share/metainfo/ com.bitwarden.desktop.appdata.xml
      - install -D -m0755 bitwarden.sh /app/bin/bitwarden
    sources:
      -
        type: file
        only-arches:
          - x86_64
        sha256: 161c015843f089713dcd25cb9a366e3e8f5230cb23230f6782c84edee29d3e5c
        url: https://github.com/bitwarden/desktop/releases/download/v1.12.0/Bitwarden-1.12.0-amd64.deb
      -
        type: file
        sha256: 098df0fc5aea04b19d9e47e9e2f5e8629ef644c5965435ab579b8aba04d34d9b
        url: https://github.com/bitwarden/desktop/archive/v1.12.0.tar.gz
      -
        type: file
        path: com.bitwarden.desktop.appdata.xml
      -
        type: script
        commands:
          - exec env TMPDIR=${XDG_CACHE_HOME}/tmp/ /app/Bitwarden/bitwarden "$@"
        dest-filename: bitwarden.sh
